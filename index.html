<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Reward App</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Monetag SDK -->
    <script src='//whephiwums.com/sdk.js' data-zone='9290936' data-sdk='show_9290936'></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom, #1E90FF, #FFFFFF);
            margin: 0;
            padding: 0;
        }
        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            padding: 20px;
            margin: 10px;
        }
        .footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: #2C3E50;
            padding: 10px 0;
            display: flex;
            justify-content: space-around;
        }
        .footer a {
            color: white;
            font-size: 24px;
        }
        .btn {
            background: linear-gradient(to right, #FF4500, #FF8C00);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
        }
        .btn-green {
            background: linear-gradient(to right, #32CD32, #98FB98);
        }
        .page { display: none; }
        .page.active { display: block; }
        @media (min-width: 768px) {
            .card { max-width: 600px; margin: 20px auto; }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="p-4 bg-white shadow">
            <h1 class="text-2xl font-bold text-center">My Reward App</h1>
            <div id="login-status" class="text-right"></div>
        </header>

        <!-- Home Page -->
        <div id="home-page" class="page active">
            <div class="card">
                <h2 class="text-xl font-bold">👤 User Profile</h2>
                <p id="user-name">Name: Loading...</p>
                <p id="user-coins">🪙 Coins: 0</p>
                <p id="user-referrals">👥 Referrals: 0</p>
                <p id="user-status">✅ Status: Active</p>
            </div>
            <div class="card">
                <h2 class="text-xl font-bold">⛏️ Mining</h2>
                <p id="mining-rate">Mining: 0.5 coins/min</p>
                <div class="w-full bg-gray-200 rounded-full h-4">
                    <div id="mining-progress" class="bg-blue-500 h-4 rounded-full" style="width: 0%"></div>
                </div>
                <div id="boost-btn" class="btn mt-4">🚀 Boost</div>
            </div>
            <div class="card">
                <h2 class="text-xl font-bold">📢 Ad</h2>
                <div id="ad-container">
                    <script src='//whephiwums.com/sdk.js' data-zone='9290936'></script>
                </div>
            </div>
        </div>

        <!-- Withdraw Page -->
        <div id="withdraw-page" class="page">
            <div class="card">
                <h2 class="text-xl font-bold">💸 Withdraw</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="card cursor-pointer" onclick="showWithdrawForm('bkash')">
                        <img src="https://via.placeholder.com/50" alt="Bkash" class="mx-auto">
                        <p class="text-center">Bkash</p>
                    </div>
                    <div class="card cursor-pointer" onclick="showWithdrawForm('rocket')">
                        <img src="https://via.placeholder.com/50" alt="Rocket" class="mx-auto">
                        <p class="text-center">Rocket</p>
                    </div>
                    <div class="card cursor-pointer" onclick="showWithdrawForm('nagad')">
                        <img src="https://via.placeholder.com/50" alt="Nagad" class="mx-auto">
                        <p class="text-center">Nagad</p>
                    </div>
                </div>
                <div id="withdraw-form" class="mt-4 hidden">
                    <p id="balance">🪙 Balance: 0 coins = 0 BDT</p>
                    <p id="min-withdraw">Minimum Withdraw: 50 BDT</p>
                    <p id="withdraw-note">Note: Payment will be processed within 24 hours.</p>
                    <input id="withdraw-amount" type="number" placeholder="Amount (BDT)" class="w-full p-2 mt-2 border rounded">
                    <input id="withdraw-number" type="text" placeholder="Payment Number" class="w-full p-2 mt-2 border rounded">
                    <div id="withdraw-submit" class="btn btn-green mt-4">💸 Submit</div>
                </div>
            </div>
        </div>

        <!-- Leaderboard Page -->
        <div id="leaderboard-page" class="page">
            <div class="card">
                <h2 class="text-xl font-bold">🏆 Leaderboard</h2>
                <table class="w-full text-left">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Name</th>
                            <th>Coins</th>
                            <th>Withdrawn</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard-table"></tbody>
                </table>
            </div>
        </div>

        <!-- About Us Page -->
        <div id="about-page" class="page">
            <div class="card">
                <h2 class="text-xl font-bold">ℹ️ About Us</h2>
                <p id="about-content">We are a reward app that lets you earn coins...</p>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <a href="#" onclick="showPage('home')">🏠</a>
            <a href="#" onclick="showPage('withdraw')">💸</a>
            <a href="#" onclick="showPage('leaderboard')">🏆</a>
            <a href="#" onclick="showPage('about')">ℹ️</a>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAERcX_1Ih1XBeFFQfJKMCWNoYnkNv-Tw8",
            authDomain: "my-reward-app-b2d1b.firebaseapp.com",
            projectId: "my-reward-app-b2d1b",
            storageBucket: "my-reward-app-b2d1b.firebasestorage.app",
            messagingSenderId: "830505812403",
            appId: "1:830505812403:web:2745761226ca2ad72e4bc6"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Telegram Web App
        const telegram = window.Telegram.WebApp;
        telegram.ready();

        // User Data
        let userId = telegram.initDataUnsafe.user ? telegram.initDataUnsafe.user.id : 'test_user';
        let userName = telegram.initDataUnsafe.user ? telegram.initDataUnsafe.user.first_name : 'Test User';
        let coins = 0;
        let referrals = 0;
        let miningRate = 0.5; // Default coins/min
        let boostPercentage = 50; // Default boost
        let boostDuration = 10; // Default seconds
        let coinToBdt = 0.1; // 1 coin = 0.1 BDT
        let minWithdraw = 50; // Default BDT

        // Page Navigation
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(`${pageId}-page`).classList.add('active');
        }

        // Load User Data
        async function loadUserData() {
            const userDoc = await db.collection('users').doc(userId).get();
            if (userDoc.exists) {
                const data = userDoc.data();
                coins = data.coins || 0;
                referrals = data.referrals || 0;
                document.getElementById('user-name').innerText = `Name: ${userName}`;
                document.getElementById('user-coins').innerText = `🪙 Coins: ${coins}`;
                document.getElementById('user-referrals').innerText = `👥 Referrals: ${referrals}`;
                document.getElementById('user-status').innerText = `✅ Status: ${data.status || 'Active'}`;
            } else {
                await db.collection('users').doc(userId).set({
                    name: userName,
                    coins: 0,
                    referrals: 0,
                    status: 'Active'
                });
            }
            startMining();
        }

        // Load Settings
        async function loadSettings() {
            const settingsDoc = await db.collection('settings').doc('general').get();
            if (settingsDoc.exists) {
                const data = settingsDoc.data();
                miningRate = data.miningRate || 0.5;
                boostPercentage = data.boostPercentage || 50;
                boostDuration = data.boostDuration || 10;
                coinToBdt = data.coinToBdt || 0.1;
                minWithdraw = data.minWithdraw || 50;
                document.getElementById('mining-rate').innerText = `Mining: ${miningRate} coins/min`;
                document.getElementById('balance').innerText = `🪙 Balance: ${coins} coins = ${(coins * coinToBdt).toFixed(2)} BDT`;
                document.getElementById('min-withdraw').innerText = `Minimum Withdraw: ${minWithdraw} BDT`;
                document.getElementById('withdraw-note').innerText = `Note: ${data.withdrawNote || 'Payment will be processed within 24 hours.'}`;
                document.getElementById('about-content').innerText = data.aboutContent || 'We are a reward app that lets you earn coins...';
            }
        }

        // Mining Logic
        function startMining() {
            let progress = 0;
            setInterval(async () => {
                progress += (miningRate / 60); // Coins per second
                coins += (miningRate / 60);
                document.getElementById('mining-progress').style.width = `${(progress % 100)}%`;
                document.getElementById('user-coins').innerText = `🪙 Coins: ${coins.toFixed(2)}`;
                document.getElementById('balance').innerText = `🪙 Balance: ${coins.toFixed(2)} coins = ${(coins * coinToBdt).toFixed(2)} BDT`;
                await db.collection('users').doc(userId).update({ coins });
            }, 1000);
        }

        // Boost Button
        document.getElementById('boost-btn').addEventListener('click', () => {
            show_9290936().then(() => {
                alert('You have seen an ad! Boost activated!');
                const originalRate = miningRate;
                miningRate *= (1 + boostPercentage / 100);
                document.getElementById('mining-rate').innerText = `Mining: ${miningRate.toFixed(2)} coins/min`;
                setTimeout(() => {
                    miningRate = originalRate;
                    document.getElementById('mining-rate').innerText = `Mining: ${miningRate} coins/min`;
                }, boostDuration * 1000);
            }).catch(err => alert('Ad failed to load. Try again.'));
        });

        // Withdraw Form
        let selectedMethod = '';
        function showWithdrawForm(method) {
            selectedMethod = method;
            document.getElementById('withdraw-form').classList.remove('hidden');
        }

        document.getElementById('withdraw-submit').addEventListener('click', async () => {
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const number = document.getElementById('withdraw-number').value;
            if (amount < minWithdraw || amount > coins * coinToBdt) {
                alert('Invalid amount!');
                return;
            }
            await db.collection('withdraw_requests').add({
                userId,
                userName,
                amount,
                method: selectedMethod,
                number,
                status: 'Pending',
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            alert('Withdraw request submitted!');
            document.getElementById('withdraw-form').classList.add('hidden');
        });

        // Load Leaderboard
        async function loadLeaderboard() {
            const snapshot = await db.collection('users').orderBy('coins', 'desc').limit(10).get();
            const table = document.getElementById('leaderboard-table');
            table.innerHTML = '';
            let rank = 1;
            snapshot.forEach(doc => {
                const data = doc.data();
                const row = `<tr>
                    <td>${rank === 1 ? '🥇' : rank === 2 ? '🥈' : rank === 3 ? '🥉' : rank}</td>
                    <td>${data.name}</td>
                    <td>${data.coins.toFixed(2)}</td>
                    <td>${(data.withdrawn || 0).toFixed(2)} BDT</td>
                </tr>`;
                table.innerHTML += row;
                rank++;
            });
        }

        // Initialize
        document.getElementById('login-status').innerText = telegram.initDataUnsafe.user ? `Logged in as ${userName}` : 'Test Mode';
        loadUserData();
        loadSettings();
        loadLeaderboard();
    </script>
</body>
</html>
